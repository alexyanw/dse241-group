<!DOCTYPE html>
<html>
  <head>

    <!-- meta -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--css-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="css/c3.min.css">
    <link rel="stylesheet" href="css/styles.css" />

  </head>
  <body>

    <div class="container-fluid">
      <div class="row">
        <div class="col-md-8">
          <h1>Winter Olympics Medals Statistics</h1>
        </div>
        <div class="col-md-4 header">
          <p class='extra-space' >Group 
          <a class='extra-space' href="mailto:s9ahmad@eng.ucsd.edu">Salah Ahmad</a>
          <a class='extra-space'  href="mailto:w9yan@eng.ucsd.edu">Wen Yan</a>
          <a class='extra-space'  href="mailto:m3wang@eng.ucsd.edu">Mengting Wang</a>
          </p>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="row">
            <div class="chart-wrapper col-md-12">
              <h2> Sport per country</h2>
              <div class="form-inline">
                <label for="filter-year-begin">year begin</label>
                <select id="filter-year-begin" class="form-control"> </select>
                <label for="filter-year-end">year end</label>
                <select id="filter-year-end" class="form-control"> </select>
              </div>

							<div id='barchart-country-sport'></div>
            </div>
            <div class="chart-wrapper col-md-12">
              <h2> medals per country</h2>
							<div id='barchart-country-medal'></div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="row">
          </div>
          <div class="row">
            <h2>Heatmap country/year</h2>
          </div>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.map"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.0/moment.min.js"></script>
    <script src="js/c3.min.js"></script>
<!--
    <script src="js/scripts.js"></script>
-->

  </body>

<script>

function draw_stacked_bar(docid, columns, jsondata) {
  console.log(JSON.stringify(jsondata));
  console.log(jsondata.length);
	var chart = c3.generate({
			bindto: docid,
			data: {
				json: jsondata,
				type: 'bar',
				keys: {
					x: 'Country',
					value: columns
				},
        groups: [columns ]
			},
			axis: {
					x: {
							type: 'category',
					}
			}
	});
}

function update_year(years) {
	years.forEach( function(value, index) {
		$('#filter-year-begin').append($("<option></option>").text(value)); 
		$('#filter-year-end').append($("<option></option>").text(value)); 
	});
}

function show_two_dimension(docid, x_col, stack_col, csv_data) {
  // get all sports
  var stack_categories = d3.nest()
    .key(function(d) { return d[stack_col]; })
    .rollup(function(v) { return v.length; })
    .map(csv_data);
  stack_categories = Object.keys(stack_categories);
  console.log(stack_categories);

  // filter by year
  var data = d3.nest()
		.key(function(d) { return d[x_col];}).sortValues(d3.ascending)
		.key(function(d) { return d[stack_col];}).sortValues(d3.descending)
		.rollup(function(v) { 
			return v.length;
		}).entries(csv_data);

  //console.log(data);
  
  rows = data.map(function(d) {
	  var row = d3.nest()
			.key(function(d){ return d.key; })
			.rollup(function(v){ return v[0].values; })
		  .map(d.values);
    row[x_col] = d.key;
    return row; 
  });
  //console.log(JSON.stringify(rows));

  //return data;
  draw_stacked_bar(docid, stack_categories, rows);
}

d3.csv("data/exercise2-olympics.csv", function(error, csv_data) {

  var years = d3.nest()
    .key(function(d) { return d.Year; })
    .rollup(function(v) { return v.length; })
    .map(csv_data);
  years = Object.keys(years).sort();

  console.log(years);
  update_year(years);

  show_two_dimension('#barchart-country-sport', 'Country', 'Sport', csv_data);
  show_two_dimension('#barchart-country-medal', 'Country', 'Medal', csv_data);
});

</script>
</html>
