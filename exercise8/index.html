<!DOCTYPE html>
<html>
  <meta charset="utf-8">

  <head>
    <title>Geospatial and Temporal Visualization</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/themes/base/jquery-ui.css" type="text/css" media="all" />
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css"/>
<!--
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.3.1/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.3.1/MarkerCluster.Default.css"/>
-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.min.css" type="text/css">

    <link rel="stylesheet" href="/assets/leaflet-sidebar-v2/leaflet-sidebar.css"/>
    <link rel="stylesheet" href="/assets/leaflet_vector_markers/leaflet-vector-markers.css">

    <link rel="stylesheet" href="/css/map.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js" type="text/javascript"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.12.2/d3.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-1.2.0.min.js"></script>

    <script src="js/script.js"></script>
  </head>

  <body class='index-page'>
			<nav class='navbar navbar-default navbar-fixed-top'>
				<div class="container-fluid">
          <div class="row">
            <div class="col-md-8">
              <h2>West Nile Virus across California counties</h2>
            </div>
            <div class="col-md-4 header">
              <p class='extra-space' >Group 
              <a class='extra-space' href="mailto:s9ahmad@eng.ucsd.edu">Salah Ahmad</a>
              <a class='extra-space'  href="mailto:w9yan@eng.ucsd.edu">Wen Yan</a>
              <a class='extra-space'  href="mailto:m3wang@eng.ucsd.edu">Mengting Wang</a>
              </p>
            </div>
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
			</nav>

		<div id='main-container' class="container-fluid">
			<div class='row'>
				<div class='col-sm-6 col-md-8'>
					<div class='left-container'>
						<div id="map" class="sidebar-map"> </div>
					</div>
				</div>

				<div class='col-sm-6 col-md-4'>
					<div>
						<h2>filter</h2>
					</div>
					<div>
						<h2>statitics</h2>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.js"></script>
<!--
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.3.1/leaflet.markercluster-src.js"></script>
-->
<script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
<script src="/assets/leaflet-sidebar-v2/leaflet-sidebar.min.js"></script>
<script src="/assets/leaflet_vector_markers/leaflet-vector-markers.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script>

//define a boundary box around CA to limit the map to
//let bounds = new L.LatLngBounds(new L.LatLng(33.627056, -117.943720), new L.LatLng(32.226014, -116.5608));
let bounds = new L.LatLngBounds(new L.LatLng(42.245210, -127.278267), new L.LatLng(32.342943, -110.486167));

//create layers
let mbAttr = 'Map data &copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
						 '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
						 'Imagery Â© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> ' +
						 '<a href="https://www.mapbox.com/map-feedback/">Improve map</a>';

mapboxAccessToken = 'pk.eyJ1IjoiYzZzYW5kZXIiLCJhIjoiY2l6ZWpmaHl3MXYwYTJ3cXBlaXBqeXJwcyJ9.QbYtu1dpRdbLFxfhOkqMmA';
let mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=' + mapboxAccessToken;

let grayscale = L.tileLayer(mbUrl, {id: 'mapbox.light', attribution: mbAttr}),
    streets   = L.tileLayer(mbUrl, {id: 'mapbox.streets', attribution: mbAttr}),
    openstreetmap = L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png");

let map = new L.Map("map", {
			center: bounds.getCenter(), maxBounds: bounds,
      maxBoundsViscosity: 1.0, zoom: 7, minZoom: 6, maxZoom: 10,
			layers: [grayscale]}
);

let baseLayers = {
  "Streets": streets,
  "Grayscale": grayscale,
  "Openstreetmap": openstreetmap,
};

var controlLayers = L.control.layers(baseLayers).addTo(map);

var ca_boundary = new L.geoJson();
ca_boundary.addTo(map);
controlLayers.addOverlay(ca_boundary, 'California boundary');

function style(feature) {
    return {
        //fillColor: getColor(feature.properties.density),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}

function onEachFeature(feature, layer) {
		layer._leaflet_id = feature.id; 
    layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
    });
}

var county_boundary = new L.geoJson(null, {
															onEachFeature: onEachFeature
														});
county_boundary.addTo(map);
controlLayers.addOverlay(county_boundary, 'county boundary');

$.ajax({
	dataType: "json",
	url: "data/california.geojson",
	success: function(data) {
			ca_boundary.addData(data);
	}
}).error(function() {});

var county_ids = {};
$.ajax({
	dataType: "json",
	url: "data/jsoncounties-CA.min.geojson",
	success: function(data) {
      all = data['features']['counties'];
      for(var i in all) {
        var county = all[i];
        //HACK: fix the format issue in data
        county['id'] = 9000 + i;
				county_ids[county['name']] = county['id'];
        county['type'] = 'Feature';
        county['properties'] = {'name': county['name']};
        if(!('geometry' in county) || !('type' in county['geometry'])) {
					continue;
				}
        if(county['geometry']['type'] == 'MultiPolygon') {
					county['geometry']['coordinates'] = [county['geometry']['coordinates']];
				}
				county_boundary.addData(county);
			}
	}
}).error(function() {});

let sidebar = L.control.sidebar('sidebar').addTo(map);

</script>
</html>
